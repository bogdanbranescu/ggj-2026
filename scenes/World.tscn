[gd_scene format=3 uid="uid://bvv4fg3ishhi4"]

[ext_resource type="Script" uid="uid://clsxunupsko1o" path="res://scripts/World.gd" id="1_u6prc"]
[ext_resource type="PackedScene" uid="uid://dxnwsxjikbiht" path="res://scenes/Fighter.tscn" id="2_1lgw5"]
[ext_resource type="Script" uid="uid://c1ysxw4w7211r" path="res://scripts/StateManager.gd" id="2_h1bdy"]
[ext_resource type="AudioStream" uid="uid://d0dfjciqdk6ps" path="res://audio/music/battle_music.wav" id="2_i4b1j"]
[ext_resource type="Script" uid="uid://couw105c3bde4" path="res://addons/godot_state_charts/state_chart.gd" id="2_qcxh3"]
[ext_resource type="Script" uid="uid://jk2jm1g6q853" path="res://addons/godot_state_charts/compound_state.gd" id="3_d4162"]
[ext_resource type="AudioStream" uid="uid://dnfrvla07pi1w" path="res://audio/sfx/fight.wav" id="3_i4b1j"]
[ext_resource type="AudioStream" uid="uid://j6tpe0phvr2k" path="res://audio/sfx/end_knockout.wav" id="4_c0d7e"]
[ext_resource type="Script" uid="uid://cytafq8i1y8qm" path="res://addons/godot_state_charts/atomic_state.gd" id="4_ywcf5"]
[ext_resource type="Script" uid="uid://co8or8igfhm70" path="res://scripts/Camera.gd" id="5_hlk0d"]
[ext_resource type="AudioStream" uid="uid://k5nv6hgmy53e" path="res://audio/sfx/you_win.wav" id="5_rpuxp"]
[ext_resource type="Script" uid="uid://cf1nsco3w0mf6" path="res://addons/godot_state_charts/transition.gd" id="6_7c4bj"]
[ext_resource type="AudioStream" uid="uid://dsgeooy7tu6mw" path="res://audio/sfx/victory_jingle.wav" id="6_nthub"]
[ext_resource type="Script" uid="uid://cty4ggpa7ngot" path="res://scripts/MaskSpawner.gd" id="7_ygioq"]
[ext_resource type="Texture2D" uid="uid://cxegsudfpucdm" path="res://gfx/environment/Stage_tile.png" id="8_i4b1j"]
[ext_resource type="Script" uid="uid://b3crfnjfspji" path="res://scripts/UI.gd" id="12_7c4bj"]
[ext_resource type="Texture2D" uid="uid://dyua2xrsed6hy" path="res://ui/character_portrait.tres" id="15_o1tcx"]
[ext_resource type="Shader" uid="uid://bqculv2ulltgq" path="res://ui/shader/damage_flash.gdshader" id="15_rpuxp"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_d1c63"]
size = Vector2(2000, 20)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_1lgw5"]
size = Vector2(20, 1000)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_hlk0d"]
size = Vector2(20, 1000)

[sub_resource type="Shader" id="Shader_o1tcx"]
code = "shader_type canvas_item;

uniform float treshold = 1.0;
uniform float speed = 25.0;
uniform int fighter_id;

void fragment() {
	if (fighter_id == 1) {
		COLOR.rgb = vec3(0.93, 0.25, 0.14);	
	} else {
		COLOR.rgb = vec3(0.33, 0.51, 0.25);	
	}
	
	if (sin(TIME * speed) > treshold) {
		COLOR.rgb = vec3(1.0, 1.0, 1.0);
	}
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_nthub"]
shader = SubResource("Shader_o1tcx")
shader_parameter/treshold = 1.0
shader_parameter/speed = 25.0
shader_parameter/fighter_id = 1

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_o1tcx"]
bg_color = Color(0.101960786, 0.0627451, 0.17254902, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_c0d7e"]
bg_color = Color(0.78039217, 0.0627451, 0.17254902, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_o1tcx"]
shader = ExtResource("15_rpuxp")
shader_parameter/treshold = 1.0
shader_parameter/speed = 25.0
shader_parameter/fighter_id = 0

[node name="World" type="Node2D" unique_id=98757806]
script = ExtResource("1_u6prc")

[node name="BGM" type="AudioStreamPlayer" parent="." unique_id=525985914]
process_mode = 3
stream = ExtResource("2_i4b1j")
volume_db = -3.0
autoplay = true

[node name="AnnouncerFIGHT" type="AudioStreamPlayer" parent="." unique_id=42646547]
process_mode = 3
stream = ExtResource("3_i4b1j")

[node name="AnnouncerKNOCKOUT" type="AudioStreamPlayer" parent="." unique_id=1846012000]
process_mode = 3
stream = ExtResource("4_c0d7e")

[node name="AnnouncerWIN" type="AudioStreamPlayer" parent="." unique_id=1457396599]
process_mode = 3
stream = ExtResource("5_rpuxp")
pitch_scale = 1.1
bus = &"YOU_WIN"

[node name="VictoryJingle" type="AudioStreamPlayer" parent="." unique_id=412431334]
process_mode = 3
stream = ExtResource("6_nthub")

[node name="TimeKeeper" type="Timer" parent="." unique_id=939310887]

[node name="StateManager" type="Node" parent="." unique_id=96067999]
script = ExtResource("2_h1bdy")

[node name="StateChart" type="Node" parent="StateManager" unique_id=2129547545]
script = ExtResource("2_qcxh3")
metadata/_custom_type_script = "uid://couw105c3bde4"

[node name="Mode" type="Node" parent="StateManager/StateChart" unique_id=2027981006]
script = ExtResource("3_d4162")
initial_state = NodePath("Main")

[node name="Intro" type="Node" parent="StateManager/StateChart/Mode" unique_id=916320550]
script = ExtResource("4_ywcf5")

[node name="Main" type="Node" parent="StateManager/StateChart/Mode" unique_id=2001730230]
script = ExtResource("4_ywcf5")

[node name="_Outro" type="Node" parent="StateManager/StateChart/Mode/Main" unique_id=1781005626]
script = ExtResource("6_7c4bj")
to = NodePath("../../Outro")
event = &"game_over"
delay_in_seconds = "0.0"

[node name="Pause" type="Node" parent="StateManager/StateChart/Mode" unique_id=352779452]
script = ExtResource("4_ywcf5")

[node name="Outro" type="Node" parent="StateManager/StateChart/Mode" unique_id=1479262261]
script = ExtResource("4_ywcf5")

[node name="Environment" type="Node2D" parent="." unique_id=1303032420]

[node name="Solid" type="TextureRect" parent="Environment" unique_id=1543143857]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -1906.0
offset_top = -1513.0
offset_right = 13094.0
offset_bottom = 8487.0
grow_horizontal = 2
grow_vertical = 2
scale = Vector2(0.25, 0.25)
texture = ExtResource("8_i4b1j")
stretch_mode = 1

[node name="Backdrop" type="ColorRect" parent="Environment" unique_id=1901950974]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -990.0
offset_top = -709.0
offset_right = 6930.0
offset_bottom = 2887.0
grow_horizontal = 2
grow_vertical = 2
scale = Vector2(0.25, 0.25)
color = Color(1, 0.93333334, 0.75, 1)

[node name="Ground" type="StaticBody2D" parent="Environment" unique_id=821027775]
collision_layer = 5

[node name="CollisionShape2D" type="CollisionShape2D" parent="Environment/Ground" unique_id=604389993]
position = Vector2(0, 200)
shape = SubResource("RectangleShape2D_d1c63")

[node name="LimitLeft" type="StaticBody2D" parent="Environment" unique_id=136285355]
position = Vector2(-1000, -300)
collision_layer = 5

[node name="CollisionShape2D" type="CollisionShape2D" parent="Environment/LimitLeft" unique_id=48154889]
shape = SubResource("RectangleShape2D_1lgw5")

[node name="LimitRight" type="StaticBody2D" parent="Environment" unique_id=510609239]
position = Vector2(1000, -298)
collision_layer = 5

[node name="CollisionShape2D" type="CollisionShape2D" parent="Environment/LimitRight" unique_id=1813589498]
shape = SubResource("RectangleShape2D_hlk0d")

[node name="MaskSpawner" type="Node2D" parent="Environment" unique_id=1648894721]
position = Vector2(-2, -671)
script = ExtResource("7_ygioq")

[node name="Timer" type="Timer" parent="Environment/MaskSpawner" unique_id=1365486248]

[node name="Characters" type="Node2D" parent="." unique_id=1944501478]

[node name="Camera" type="Camera2D" parent="Characters" unique_id=2044144339]
position = Vector2(1, -1)
zoom = Vector2(2, 2)
position_smoothing_enabled = true
script = ExtResource("5_hlk0d")

[node name="Fighter_1" parent="Characters" unique_id=2083199202 instance=ExtResource("2_1lgw5")]
position = Vector2(-316, 1)

[node name="Fighter_2" parent="Characters" unique_id=937528637 instance=ExtResource("2_1lgw5")]
position = Vector2(316, 0)

[node name="UI" type="CanvasLayer" parent="." unique_id=418506312]

[node name="UI" type="Control" parent="UI" unique_id=1084686285]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("12_7c4bj")

[node name="UIContainer" type="VBoxContainer" parent="UI/UI" unique_id=1958297920]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.04
anchor_top = 0.06
anchor_right = 0.96
anchor_bottom = 0.94
grow_horizontal = 2
grow_vertical = 2

[node name="Bars" type="HBoxContainer" parent="UI/UI/UIContainer" unique_id=1442292978]
layout_mode = 2
alignment = 1

[node name="Player1" type="HBoxContainer" parent="UI/UI/UIContainer/Bars" unique_id=1417865689]
layout_mode = 2
size_flags_horizontal = 3

[node name="Icon" type="TextureRect" parent="UI/UI/UIContainer/Bars/Player1" unique_id=108761374]
material = SubResource("ShaderMaterial_nthub")
custom_minimum_size = Vector2(100, 100)
layout_mode = 2
texture = ExtResource("15_o1tcx")
expand_mode = 1

[node name="MarginContainer" type="MarginContainer" parent="UI/UI/UIContainer/Bars/Player1" unique_id=1358472944]
custom_minimum_size = Vector2(30, 0)
layout_mode = 2

[node name="Value" type="ProgressBar" parent="UI/UI/UIContainer/Bars/Player1" unique_id=1804939456]
custom_minimum_size = Vector2(0, 100)
layout_mode = 2
size_flags_horizontal = 3
size_flags_vertical = 1
theme_override_styles/background = SubResource("StyleBoxFlat_o1tcx")
theme_override_styles/fill = SubResource("StyleBoxFlat_c0d7e")
step = 1.0
show_percentage = false

[node name="MarginContainer" type="MarginContainer" parent="UI/UI/UIContainer/Bars" unique_id=1333730201]
custom_minimum_size = Vector2(200, 0)
layout_mode = 2

[node name="Player2" type="HBoxContainer" parent="UI/UI/UIContainer/Bars" unique_id=1428558611]
layout_mode = 2
size_flags_horizontal = 3
alignment = 2

[node name="Value" type="ProgressBar" parent="UI/UI/UIContainer/Bars/Player2" unique_id=1437464495]
custom_minimum_size = Vector2(0, 100)
layout_mode = 2
size_flags_horizontal = 3
size_flags_vertical = 1
theme_override_styles/background = SubResource("StyleBoxFlat_o1tcx")
theme_override_styles/fill = SubResource("StyleBoxFlat_c0d7e")
step = 1.0
fill_mode = 1
show_percentage = false

[node name="MarginContainer" type="MarginContainer" parent="UI/UI/UIContainer/Bars/Player2" unique_id=531156410]
custom_minimum_size = Vector2(30, 0)
layout_mode = 2

[node name="Icon" type="TextureRect" parent="UI/UI/UIContainer/Bars/Player2" unique_id=1575365034]
material = SubResource("ShaderMaterial_o1tcx")
custom_minimum_size = Vector2(100, 100)
layout_mode = 2
texture = ExtResource("15_o1tcx")
expand_mode = 1
flip_h = true
